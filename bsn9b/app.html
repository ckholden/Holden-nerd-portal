<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nursing Documentation Pro</title>
    <script>
        // Auth check - redirect to login if not authenticated
        if (sessionStorage.getItem('bsn9b_auth') !== 'true') {
            window.location.href = 'index.html';
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@7.8.2/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0f3460 0%, #533483 50%, #e94560 100%);
            color: white;
            padding: 35px;
            text-align: center;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00d9ff, #e94560, #00d9ff);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .form-container {
            padding: 35px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
            background: #fafafa;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #533483;
            box-shadow: 0 0 0 4px rgba(83, 52, 131, 0.15);
            background: white;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        textarea.large {
            min-height: 150px;
        }

        /* Note Type Cards */
        .note-type-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .note-type-card {
            padding: 18px 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .note-type-card:hover {
            border-color: #533483;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(83, 52, 131, 0.15);
        }

        .note-type-card.active {
            border-color: #533483;
            background: linear-gradient(135deg, #533483 0%, #e94560 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(83, 52, 131, 0.3);
        }

        .note-type-card h3 {
            font-size: 18px;
            margin-bottom: 6px;
        }

        .note-type-card p {
            font-size: 10px;
            opacity: 0.8;
            line-height: 1.3;
        }

        .section-title {
            font-size: 20px;
            color: #1a1a2e;
            margin: 35px 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #533483, #e94560) 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #533483, #e94560);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .note-fields {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .note-fields.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .field-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .field-letter {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #533483 0%, #e94560 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }

        .field-info {
            flex: 1;
        }

        .field-info h4 {
            font-size: 14px;
            color: #1a1a2e;
            margin-bottom: 2px;
        }

        .field-info p {
            font-size: 11px;
            color: #666;
        }

        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 35px;
        }

        .btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #e94560 0%, #533483 100%);
            color: white;
        }

        .btn-word {
            background: linear-gradient(135deg, #2b5797 0%, #1e3c72 100%);
            color: white;
        }

        .btn-clear {
            background: #f0f0f0;
            color: #333;
            flex: 0.5;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .warning-box {
            background: linear-gradient(135deg, #ffe0e0 0%, #ffcccc 100%);
            border: 2px solid #e94560;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #8b0000;
        }

        .warning-box strong {
            color: #c00;
        }

        .info-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border: 1px solid #ffc107;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            font-size: 13px;
        }

        .info-box strong {
            color: #856404;
        }

        .info-box ul {
            margin-top: 10px;
            margin-left: 20px;
        }

        .info-box li {
            margin-bottom: 5px;
            color: #6c5700;
        }

        .format-description {
            background: #f8f9ff;
            border-left: 4px solid #533483;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 0 10px 10px 0;
        }

        .format-description h4 {
            color: #533483;
            margin-bottom: 8px;
        }

        .format-description p {
            font-size: 13px;
            color: #555;
            line-height: 1.5;
        }

        .focus-input {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
            border: 2px solid #533483;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .note-type-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .form-row, .form-row.three-col {
                grid-template-columns: 1fr;
            }
            .btn-container {
                flex-direction: column;
            }
            .btn-clear {
                flex: 1;
            }
        }

        @media (max-width: 500px) {
            .note-type-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nursing Documentation Pro</h1>
            <p>Professional nursing progress notes - DARP, SOAP, SBAR, PIE & more</p>
        </div>

        <div class="form-container">
            <!-- HIPAA Warning -->
            <div class="warning-box">
                <strong>HIPAA/Privacy Notice:</strong> Do NOT enter any PHI (Protected Health Information) or PII (Personally Identifiable Information). Use patient aliases only (e.g., "J.D.", "Room 302", "42yom"). This is a practice tool for educational purposes.
            </div>

            <!-- How to Use -->
            <div class="info-box">
                <strong>How to Use:</strong>
                <ul>
                    <li>Fill in your info and patient details at the top</li>
                    <li>Select your documentation format (DAR, SOAP, etc.)</li>
                    <li>Complete the relevant fields for your note</li>
                    <li>Click <strong>Export PDF</strong> or <strong>Export Word</strong> to download</li>
                </ul>
            </div>

            <!-- Patient & Nurse Info -->
            <h2 class="section-title">
                <span class="section-icon">1</span>
                Patient & Nurse Information
            </h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Student/Nurse Name</label>
                    <input type="text" id="nurseName" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label>Credentials</label>
                    <select id="credentials">
                        <option value="Student RN">Student RN</option>
                        <option value="RN">RN</option>
                        <option value="BSN, RN">BSN, RN</option>
                        <option value="LPN">LPN</option>
                        <option value="LVN">LVN</option>
                        <option value="CNA">CNA</option>
                        <option value="NP">NP</option>
                    </select>
                </div>
            </div>
            <div class="form-row three-col">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="noteDate">
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="noteTime">
                </div>
                <div class="form-group">
                    <label>Unit/Floor</label>
                    <input type="text" id="unit" placeholder="e.g., Med-Surg 3B">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Patient Identifier (initials/room #)</label>
                    <input type="text" id="patientId" placeholder="e.g., J.D. / Room 302">
                </div>
                <div class="form-group">
                    <label>Patient Demographics</label>
                    <input type="text" id="patientDemo" placeholder="e.g., 42yom, 68yof">
                </div>
            </div>

            <!-- Note Type Selection -->
            <h2 class="section-title">
                <span class="section-icon">2</span>
                Select Documentation Format
            </h2>

            <div class="note-type-grid">
                <div class="note-type-card active" onclick="selectNoteType('dar')">
                    <h3>DAR</h3>
                    <p>Data, Action, Response<br>(Focus Charting)</p>
                </div>
                <div class="note-type-card" onclick="selectNoteType('darp')">
                    <h3>DARP</h3>
                    <p>Data, Action, Response, Plan<br>(Extended Focus)</p>
                </div>
                <div class="note-type-card" onclick="selectNoteType('soap')">
                    <h3>SOAP</h3>
                    <p>Subjective, Objective,<br>Assessment, Plan</p>
                </div>
                <div class="note-type-card" onclick="selectNoteType('soapie')">
                    <h3>SOAPIE</h3>
                    <p>SOAP + Intervention,<br>Evaluation</p>
                </div>
                <div class="note-type-card" onclick="selectNoteType('sbar')">
                    <h3>SBAR</h3>
                    <p>Situation, Background,<br>Assessment, Recommendation</p>
                </div>
                <div class="note-type-card" onclick="selectNoteType('pie')">
                    <h3>PIE</h3>
                    <p>Problem, Intervention,<br>Evaluation</p>
                </div>
            </div>

            <!-- Format Description -->
            <div class="format-description" id="formatDescription">
                <h4>DAR (Focus Charting)</h4>
                <p>Organizes documentation around a specific focus - patient concern, behavior, nursing diagnosis, or significant event. Efficient for quick, problem-centered documentation in busy units. Each note addresses one specific issue.</p>
            </div>

            <!-- Documentation Section -->
            <h2 class="section-title">
                <span class="section-icon">3</span>
                Documentation
            </h2>

            <!-- Focus Field (for DAR/DARP) -->
            <div class="form-group" id="focusGroup">
                <label>FOCUS (Patient concern, diagnosis, event, or change in condition)</label>
                <input type="text" id="focus" class="focus-input" placeholder="e.g., Pain management, IVC placement, Fall risk, Post-op assessment">
            </div>

            <!-- DAR Fields -->
            <div id="darFields" class="note-fields active">
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">D</span>
                        <div class="field-info">
                            <h4>Data</h4>
                            <p>Subjective & objective information supporting the focus</p>
                        </div>
                    </div>
                    <textarea id="darData" class="large" placeholder="Include both subjective (patient statements) and objective (vital signs, observations) data.&#10;&#10;Example: 42yom, BIBA for dehydration. Patient states 'I feel dizzy.' A/O x4, HR 115, BP 110/70, RR 20, SpO2 98% RA, T 100Â°F, Pain 0/10. Skin warm, dry. Mucous membranes dry."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">A</span>
                        <div class="field-info">
                            <h4>Action</h4>
                            <p>Nursing interventions performed</p>
                        </div>
                    </div>
                    <textarea id="darAction" class="large" placeholder="Document all nursing actions taken.&#10;&#10;Example: Placed 22g IVC in R AC using aseptic technique. Site assessed - no redness, swelling, or tenderness. Flushed with 3mL NS, patency confirmed. Initiated LR 500mL at 250mL/hr per order. Site dressed with Tegaderm, labeled with date/time/initials."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">R</span>
                        <div class="field-info">
                            <h4>Response</h4>
                            <p>Patient's response to interventions</p>
                        </div>
                    </div>
                    <textarea id="darResponse" placeholder="How did the patient respond?&#10;&#10;Example: Tolerated IVC placement well. Verbalized understanding of need for IV fluids. Site remains clean, dry, intact. No signs of infiltration or phlebitis."></textarea>
                </div>
            </div>

            <!-- DARP Fields -->
            <div id="darpFields" class="note-fields">
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">D</span>
                        <div class="field-info">
                            <h4>Data</h4>
                            <p>Subjective & objective information supporting the focus</p>
                        </div>
                    </div>
                    <textarea id="darpData" class="large" placeholder="Include both subjective and objective data.&#10;&#10;Example: Patient reports pain 7/10 to surgical incision site. Guarding noted. Incision clean, dry, intact with mild erythema at edges. VS: HR 92, BP 138/86."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">A</span>
                        <div class="field-info">
                            <h4>Action</h4>
                            <p>Nursing interventions performed</p>
                        </div>
                    </div>
                    <textarea id="darpAction" class="large" placeholder="Document interventions.&#10;&#10;Example: Administered Morphine 4mg IV push per order at 1400. Repositioned patient to left side. Applied ice pack to surgical site. Provided relaxation techniques education."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">R</span>
                        <div class="field-info">
                            <h4>Response</h4>
                            <p>Patient's response to interventions</p>
                        </div>
                    </div>
                    <textarea id="darpResponse" placeholder="Patient response.&#10;&#10;Example: At 1430, patient reports pain decreased to 3/10. Resting comfortably. No adverse reactions to medication noted. HR 78, BP 124/76."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">P</span>
                        <div class="field-info">
                            <h4>Plan</h4>
                            <p>Future care plans and follow-up</p>
                        </div>
                    </div>
                    <textarea id="darpPlan" placeholder="Outline ongoing care plan.&#10;&#10;Example: Continue pain assessment q2h. May repeat Morphine 4mg IV q4h PRN. Encourage use of PCA if pain not well controlled. Notify MD if pain increases or signs of infection develop."></textarea>
                </div>
            </div>

            <!-- SOAP Fields -->
            <div id="soapFields" class="note-fields">
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">S</span>
                        <div class="field-info">
                            <h4>Subjective</h4>
                            <p>Patient's statements, symptoms, feelings in their own words</p>
                        </div>
                    </div>
                    <textarea id="soapSubjective" class="large" placeholder="Document what the patient tells you.&#10;&#10;Example: Patient states, 'I've been having chest pain for the past 2 hours. It feels like pressure.' Rates pain 6/10, radiating to left arm. Denies shortness of breath, nausea, or diaphoresis."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">O</span>
                        <div class="field-info">
                            <h4>Objective</h4>
                            <p>Measurable data: vital signs, lab values, physical assessment findings</p>
                        </div>
                    </div>
                    <textarea id="soapObjective" class="large" placeholder="Document measurable, observable data.&#10;&#10;Example: VS: HR 98, BP 156/92, RR 18, SpO2 97% RA, T 98.6Â°F. Alert and oriented x4. Skin warm, dry. Lungs clear bilaterally. Heart S1S2, regular rhythm. No peripheral edema. EKG shows NSR. Troponin pending."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">A</span>
                        <div class="field-info">
                            <h4>Assessment</h4>
                            <p>Nursing diagnosis, clinical judgment, interpretation of data</p>
                        </div>
                    </div>
                    <textarea id="soapAssessment" placeholder="Your clinical assessment/nursing diagnosis.&#10;&#10;Example: Acute pain related to possible cardiac etiology as evidenced by patient report of 6/10 chest pressure with radiation to left arm. Risk for decreased cardiac output. Anxiety related to unknown diagnosis."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">P</span>
                        <div class="field-info">
                            <h4>Plan</h4>
                            <p>Interventions, treatments, patient education, follow-up</p>
                        </div>
                    </div>
                    <textarea id="soapPlan" placeholder="Document the care plan.&#10;&#10;Example: Continue cardiac monitoring. Administer aspirin 325mg PO and nitroglycerin 0.4mg SL per chest pain protocol. Obtain serial troponins q6h. Keep patient NPO. Prepare for possible cardiac catheterization. Provide emotional support and education."></textarea>
                </div>
            </div>

            <!-- SOAPIE Fields -->
            <div id="soapieFields" class="note-fields">
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">S</span>
                        <div class="field-info">
                            <h4>Subjective</h4>
                            <p>Patient's statements and reported symptoms</p>
                        </div>
                    </div>
                    <textarea id="soapieSubjective" placeholder="Patient states, 'I can't catch my breath when I walk to the bathroom.'"></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">O</span>
                        <div class="field-info">
                            <h4>Objective</h4>
                            <p>Measurable, observable clinical data</p>
                        </div>
                    </div>
                    <textarea id="soapieObjective" placeholder="VS: HR 110, BP 142/88, RR 28, SpO2 89% RA. Using accessory muscles. Bilateral lower extremity edema 2+. Crackles in bilateral lung bases."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">A</span>
                        <div class="field-info">
                            <h4>Assessment</h4>
                            <p>Nursing diagnosis or clinical judgment</p>
                        </div>
                    </div>
                    <textarea id="soapieAssessment" placeholder="Impaired gas exchange related to fluid volume overload as evidenced by SpO2 89%, crackles, and dyspnea on exertion."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">P</span>
                        <div class="field-info">
                            <h4>Plan</h4>
                            <p>Treatment strategy and goals</p>
                        </div>
                    </div>
                    <textarea id="soapiePlan" placeholder="Elevate HOB to 45Â°. Apply O2 via NC at 2L/min. Strict I&O monitoring. Daily weights. Administer Lasix 40mg IV per order."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">I</span>
                        <div class="field-info">
                            <h4>Intervention</h4>
                            <p>Specific actions taken to implement the plan</p>
                        </div>
                    </div>
                    <textarea id="soapieIntervention" placeholder="HOB elevated to 45Â°. O2 applied at 2L NC. Lasix 40mg IV administered at 0900. Foley catheter inserted for accurate output measurement. Patient education provided on fluid restriction."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">E</span>
                        <div class="field-info">
                            <h4>Evaluation</h4>
                            <p>Patient response and effectiveness of interventions</p>
                        </div>
                    </div>
                    <textarea id="soapieEvaluation" placeholder="At 1100: SpO2 improved to 94% on 2L NC. RR decreased to 20. Patient reports breathing easier. Urine output 400mL in 2 hours post-Lasix. Continue to monitor."></textarea>
                </div>
            </div>

            <!-- SBAR Fields -->
            <div id="sbarFields" class="note-fields">
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">S</span>
                        <div class="field-info">
                            <h4>Situation</h4>
                            <p>What is happening right now? Why are you calling/documenting?</p>
                        </div>
                    </div>
                    <textarea id="sbarSituation" class="large" placeholder="State the current situation clearly.&#10;&#10;Example: I am calling about Mr. Johnson in room 412. He is experiencing a rapid decline in mental status over the past hour. He was alert and oriented x4 at 0800 and is now only responding to painful stimuli."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">B</span>
                        <div class="field-info">
                            <h4>Background</h4>
                            <p>Relevant history, admitting diagnosis, pertinent medical history</p>
                        </div>
                    </div>
                    <textarea id="sbarBackground" class="large" placeholder="Provide relevant context.&#10;&#10;Example: 78yo male admitted 2 days ago for UTI and sepsis. PMH: Type 2 DM, HTN, CKD stage 3. Was improving on IV antibiotics. Last BMP showed Cr 2.1, BUN 45. Blood glucose at 0600 was 142."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">A</span>
                        <div class="field-info">
                            <h4>Assessment</h4>
                            <p>What do you think is the problem? Your clinical impression</p>
                        </div>
                    </div>
                    <textarea id="sbarAssessment" placeholder="State your clinical assessment.&#10;&#10;Example: Current VS: HR 112, BP 88/56, RR 24, T 101.8Â°F, SpO2 93% on 2L. I am concerned he may be going into septic shock. His condition has significantly deteriorated from this morning."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">R</span>
                        <div class="field-info">
                            <h4>Recommendation</h4>
                            <p>What do you need? What action should be taken?</p>
                        </div>
                    </div>
                    <textarea id="sbarRecommendation" placeholder="Make your request clear.&#10;&#10;Example: I need you to come evaluate the patient immediately. I recommend stat labs including lactate and blood cultures, possible fluid bolus and vasopressor support. Do you want me to activate the rapid response team?"></textarea>
                </div>
            </div>

            <!-- PIE Fields -->
            <div id="pieFields" class="note-fields">
                <div class="form-group">
                    <label>Problem Number (if using problem list)</label>
                    <input type="text" id="pieProblemNum" placeholder="e.g., Problem #3" style="max-width: 200px;">
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">P</span>
                        <div class="field-info">
                            <h4>Problem</h4>
                            <p>Nursing diagnosis or patient problem statement</p>
                        </div>
                    </div>
                    <textarea id="pieProblem" class="large" placeholder="State the nursing diagnosis or problem using NANDA format if applicable.&#10;&#10;Example: Impaired skin integrity related to prolonged immobility as evidenced by 2cm x 2cm stage II pressure ulcer on sacrum."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">I</span>
                        <div class="field-info">
                            <h4>Intervention</h4>
                            <p>Nursing actions taken to address the problem</p>
                        </div>
                    </div>
                    <textarea id="pieIntervention" class="large" placeholder="Document all interventions.&#10;&#10;Example: Wound cleansed with NS, measured and photographed. Applied hydrocolloid dressing. Implemented q2h turning schedule. Placed pressure-relieving mattress on bed. Consulted wound care nurse. Educated patient and family on importance of repositioning."></textarea>
                </div>
                <div class="form-group">
                    <div class="field-header">
                        <span class="field-letter">E</span>
                        <div class="field-info">
                            <h4>Evaluation</h4>
                            <p>Effectiveness of interventions, patient progress toward goals</p>
                        </div>
                    </div>
                    <textarea id="pieEvaluation" placeholder="Evaluate outcomes.&#10;&#10;Example: Wound edges remain well-approximated. No signs of infection - no erythema, warmth, or purulent drainage. Patient tolerating repositioning without complaints. Family verbalizes understanding of turning schedule. Will reassess wound in 3 days."></textarea>
                </div>
            </div>

            <!-- Export Buttons -->
            <div class="btn-container">
                <button class="btn btn-clear" onclick="clearForm()">Clear</button>
                <button class="btn btn-word" onclick="generateWord()">
                    <span>ðŸ“„</span> Export Word
                </button>
                <button class="btn btn-pdf" onclick="generatePDF()">
                    <span>ðŸ“‘</span> Export PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        let currentNoteType = 'dar';

        const formatDescriptions = {
            dar: {
                title: 'DAR (Focus Charting)',
                desc: 'Organizes documentation around a specific focus - patient concern, behavior, nursing diagnosis, or significant event. Efficient for quick, problem-centered documentation in busy units. Each note addresses one specific issue.'
            },
            darp: {
                title: 'DARP (Extended Focus Charting)',
                desc: 'Expands on DAR by adding a Plan component. Useful when you need to document ongoing care plans and follow-up actions. Combines subjective and objective data into the Data section for efficiency.'
            },
            soap: {
                title: 'SOAP Note',
                desc: 'Traditional format separating Subjective (patient statements) from Objective (measurable data). Ideal for complex cases requiring careful tracking of patient progress. Assessment includes nursing diagnosis and clinical judgment.'
            },
            soapie: {
                title: 'SOAPIE (Extended SOAP)',
                desc: 'Adds Intervention and Evaluation components to SOAP. Provides complete documentation of the nursing process from assessment through evaluation. More comprehensive but time-consuming.'
            },
            sbar: {
                title: 'SBAR (Communication Tool)',
                desc: 'Structured communication framework used primarily for handoffs and urgent provider communication. Ensures critical information is conveyed clearly and completely. Standard for calling physicians or during shift report.'
            },
            pie: {
                title: 'PIE (Problem-Oriented)',
                desc: 'Ties documentation directly to identified nursing diagnoses using a numbered problem list. Each entry connects to a specific nursing diagnosis. Best for facilities aligning charting with NANDA diagnoses and care plans.'
            }
        };

        // Initialize
        document.getElementById('noteDate').valueAsDate = new Date();
        document.getElementById('noteTime').value = new Date().toTimeString().slice(0, 5);

        function selectNoteType(type) {
            currentNoteType = type;

            // Update cards
            document.querySelectorAll('.note-type-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.note-type-card').classList.add('active');

            // Update fields
            document.querySelectorAll('.note-fields').forEach(f => f.classList.remove('active'));
            document.getElementById(type + 'Fields').classList.add('active');

            // Show/hide focus field
            const showFocus = ['dar', 'darp'].includes(type);
            document.getElementById('focusGroup').style.display = showFocus ? 'block' : 'none';

            // Update description
            const desc = formatDescriptions[type];
            document.getElementById('formatDescription').innerHTML = `<h4>${desc.title}</h4><p>${desc.desc}</p>`;
        }

        function clearForm() {
            if (!confirm('Clear all fields?')) return;
            document.querySelectorAll('input:not([type="date"]):not([type="time"]), textarea').forEach(el => el.value = '');
            document.getElementById('noteDate').valueAsDate = new Date();
            document.getElementById('noteTime').value = new Date().toTimeString().slice(0, 5);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric', year: '2-digit' });
        }

        function formatTime(timeStr) {
            // 24-hour format (e.g., 1430, 0800)
            return timeStr.replace(':', '');
        }

        function getFormData() {
            return {
                nurseName: document.getElementById('nurseName').value || 'N/A',
                credentials: document.getElementById('credentials').value,
                noteDate: formatDate(document.getElementById('noteDate').value),
                noteTime: formatTime(document.getElementById('noteTime').value),
                rawTime: document.getElementById('noteTime').value,
                unit: document.getElementById('unit').value || '',
                patientId: document.getElementById('patientId').value || 'N/A',
                patientDemo: document.getElementById('patientDemo').value || '',
                focus: document.getElementById('focus').value || ''
            };
        }

        function getNoteContent() {
            const content = [];
            const type = currentNoteType;

            if (type === 'dar') {
                content.push({ letter: 'D', title: 'Data', text: document.getElementById('darData').value });
                content.push({ letter: 'A', title: 'Action', text: document.getElementById('darAction').value });
                content.push({ letter: 'R', title: 'Response', text: document.getElementById('darResponse').value });
            } else if (type === 'darp') {
                content.push({ letter: 'D', title: 'Data', text: document.getElementById('darpData').value });
                content.push({ letter: 'A', title: 'Action', text: document.getElementById('darpAction').value });
                content.push({ letter: 'R', title: 'Response', text: document.getElementById('darpResponse').value });
                content.push({ letter: 'P', title: 'Plan', text: document.getElementById('darpPlan').value });
            } else if (type === 'soap') {
                content.push({ letter: 'S', title: 'Subjective', text: document.getElementById('soapSubjective').value });
                content.push({ letter: 'O', title: 'Objective', text: document.getElementById('soapObjective').value });
                content.push({ letter: 'A', title: 'Assessment', text: document.getElementById('soapAssessment').value });
                content.push({ letter: 'P', title: 'Plan', text: document.getElementById('soapPlan').value });
            } else if (type === 'soapie') {
                content.push({ letter: 'S', title: 'Subjective', text: document.getElementById('soapieSubjective').value });
                content.push({ letter: 'O', title: 'Objective', text: document.getElementById('soapieObjective').value });
                content.push({ letter: 'A', title: 'Assessment', text: document.getElementById('soapieAssessment').value });
                content.push({ letter: 'P', title: 'Plan', text: document.getElementById('soapiePlan').value });
                content.push({ letter: 'I', title: 'Intervention', text: document.getElementById('soapieIntervention').value });
                content.push({ letter: 'E', title: 'Evaluation', text: document.getElementById('soapieEvaluation').value });
            } else if (type === 'sbar') {
                content.push({ letter: 'S', title: 'Situation', text: document.getElementById('sbarSituation').value });
                content.push({ letter: 'B', title: 'Background', text: document.getElementById('sbarBackground').value });
                content.push({ letter: 'A', title: 'Assessment', text: document.getElementById('sbarAssessment').value });
                content.push({ letter: 'R', title: 'Recommendation', text: document.getElementById('sbarRecommendation').value });
            } else if (type === 'pie') {
                const probNum = document.getElementById('pieProblemNum').value;
                const probTitle = probNum ? `Problem (${probNum})` : 'Problem';
                content.push({ letter: 'P', title: probTitle, text: document.getElementById('pieProblem').value });
                content.push({ letter: 'I', title: 'Intervention', text: document.getElementById('pieIntervention').value });
                content.push({ letter: 'E', title: 'Evaluation', text: document.getElementById('pieEvaluation').value });
            }

            return content.filter(c => c.text);
        }

        function generatePDF() {
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            const contentWidth = pageWidth - (margin * 2);
            let y = 20;

            const data = getFormData();
            const noteContent = getNoteContent();
            const typeNames = { dar: 'DAR (Focus Charting)', darp: 'DARP', soap: 'SOAP', soapie: 'SOAPIE', sbar: 'SBAR', pie: 'PIE' };

            // Header
            doc.setFillColor(15, 52, 96);
            doc.rect(0, 0, pageWidth, 38, 'F');
            doc.setFillColor(233, 69, 96);
            doc.rect(0, 38, pageWidth, 3, 'F');

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('Nursing Progress Note', pageWidth / 2, 18, { align: 'center' });

            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(typeNames[currentNoteType], pageWidth / 2, 30, { align: 'center' });

            y = 50;
            doc.setTextColor(0, 0, 0);

            // Info Box
            doc.setFillColor(248, 249, 255);
            doc.setDrawColor(83, 52, 131);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, y, contentWidth, 32, 3, 3, 'FD');

            doc.setFontSize(10);
            y += 10;

            doc.setFont('helvetica', 'bold');
            doc.text('Nurse:', margin + 5, y);
            doc.setFont('helvetica', 'normal');
            doc.text(`${data.nurseName}, ${data.credentials}`, margin + 22, y);

            doc.setFont('helvetica', 'bold');
            doc.text('Date/Time:', margin + 95, y);
            doc.setFont('helvetica', 'normal');
            doc.text(`${data.noteDate} @ ${data.noteTime}`, margin + 120, y);

            y += 10;
            doc.setFont('helvetica', 'bold');
            doc.text('Patient:', margin + 5, y);
            doc.setFont('helvetica', 'normal');
            const patientInfo = data.patientDemo ? `${data.patientId} (${data.patientDemo})` : data.patientId;
            doc.text(patientInfo, margin + 25, y);

            if (data.unit) {
                doc.setFont('helvetica', 'bold');
                doc.text('Unit:', margin + 95, y);
                doc.setFont('helvetica', 'normal');
                doc.text(data.unit, margin + 110, y);
            }

            y += 22;

            // Focus (for DAR/DARP)
            if (['dar', 'darp'].includes(currentNoteType) && data.focus) {
                doc.setFillColor(83, 52, 131);
                doc.roundedRect(margin, y, contentWidth, 14, 2, 2, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text('FOCUS: ' + data.focus, margin + 5, y + 9);
                y += 22;
                doc.setTextColor(0, 0, 0);
            }

            // Content sections
            noteContent.forEach(section => {
                const lines = doc.splitTextToSize(section.text, contentWidth - 20);
                const sectionHeight = 18 + (lines.length * 5.5);

                if (y + sectionHeight > 275) {
                    doc.addPage();
                    y = 20;
                }

                // Letter circle
                doc.setFillColor(83, 52, 131);
                doc.circle(margin + 8, y + 5, 7, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text(section.letter, margin + 8, y + 8, { align: 'center' });

                // Title
                doc.setTextColor(15, 52, 96);
                doc.setFontSize(11);
                doc.text(section.title, margin + 20, y + 7);

                // Content
                y += 15;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(50, 50, 50);
                lines.forEach(line => {
                    if (y > 275) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(line, margin + 5, y);
                    y += 5.5;
                });
                y += 8;
            });

            // Signature
            y += 10;
            if (y > 260) {
                doc.addPage();
                y = 20;
            }
            doc.setDrawColor(150);
            doc.setLineWidth(0.3);
            doc.line(margin, y, margin + 80, y);
            doc.setFontSize(10);
            doc.setTextColor(0);
            doc.setFont('helvetica', 'normal');
            doc.text(`${data.nurseName}, ${data.credentials}`, margin, y + 8);
            doc.text(`${data.noteDate} @ ${data.noteTime}`, margin, y + 15);

            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150);
            doc.text('Generated by Nursing Documentation Pro', pageWidth / 2, 290, { align: 'center' });

            // Save
            const filename = `${currentNoteType.toUpperCase()}_Note_${document.getElementById('noteDate').value}_${data.rawTime.replace(':', '')}.pdf`;
            doc.save(filename);
        }

        async function generateWord() {
            try {
                const data = getFormData();
                const noteContent = getNoteContent();
                const typeNames = { dar: 'DAR (Focus Charting)', darp: 'DARP', soap: 'SOAP', soapie: 'SOAPIE', sbar: 'SBAR', pie: 'PIE' };

                if (typeof docx === 'undefined') {
                    alert('Word export library failed to load. Please use PDF export or try refreshing the page.');
                    return;
                }

                const { Document, Packer, Paragraph, TextRun, AlignmentType } = docx;

            const children = [];

            // Title
            children.push(new Paragraph({
                children: [new TextRun({ text: 'Nursing Progress Note', bold: true, size: 36, color: '0f3460' })],
                alignment: AlignmentType.CENTER,
                spacing: { after: 100 }
            }));

            children.push(new Paragraph({
                children: [new TextRun({ text: typeNames[currentNoteType], size: 24, color: '533483' })],
                alignment: AlignmentType.CENTER,
                spacing: { after: 300 }
            }));

            // Info section
            const patientInfo = data.patientDemo ? `${data.patientId} (${data.patientDemo})` : data.patientId;
            children.push(new Paragraph({
                children: [
                    new TextRun({ text: 'Nurse: ', bold: true }),
                    new TextRun({ text: `${data.nurseName}, ${data.credentials}` }),
                    new TextRun({ text: '     Date/Time: ', bold: true }),
                    new TextRun({ text: `${data.noteDate} @ ${data.noteTime}` })
                ],
                spacing: { after: 100 }
            }));

            children.push(new Paragraph({
                children: [
                    new TextRun({ text: 'Patient: ', bold: true }),
                    new TextRun({ text: patientInfo }),
                    data.unit ? new TextRun({ text: '     Unit: ', bold: true }) : new TextRun(''),
                    data.unit ? new TextRun({ text: data.unit }) : new TextRun('')
                ],
                spacing: { after: 300 }
            }));

            // Focus
            if (['dar', 'darp'].includes(currentNoteType) && data.focus) {
                children.push(new Paragraph({
                    children: [new TextRun({ text: 'FOCUS: ' + data.focus, bold: true, color: '533483' })],
                    shading: { fill: 'f0f0ff' },
                    spacing: { before: 200, after: 300 }
                }));
            }

            // Content sections
            noteContent.forEach(section => {
                children.push(new Paragraph({
                    children: [
                        new TextRun({ text: `${section.letter} - ${section.title}`, bold: true, size: 24, color: '0f3460' })
                    ],
                    spacing: { before: 250, after: 100 }
                }));

                children.push(new Paragraph({
                    children: [new TextRun({ text: section.text })],
                    spacing: { after: 200 }
                }));
            });

            // Signature
            children.push(new Paragraph({ text: '', spacing: { before: 400 } }));
            children.push(new Paragraph({
                children: [new TextRun({ text: '________________________________' })],
            }));
            children.push(new Paragraph({
                children: [new TextRun({ text: `${data.nurseName}, ${data.credentials}` })],
                spacing: { after: 50 }
            }));
            children.push(new Paragraph({
                children: [new TextRun({ text: `${data.noteDate} @ ${data.noteTime}` })],
            }));

            const doc = new Document({
                sections: [{ children }]
            });

                const blob = await Packer.toBlob(doc);
                const filename = `${currentNoteType.toUpperCase()}_Note_${document.getElementById('noteDate').value}_${data.rawTime.replace(':', '')}.docx`;
                saveAs(blob, filename);
            } catch (error) {
                console.error('Word export error:', error);
                alert('Error generating Word document. Please try PDF export instead.');
            }
        }
    </script>
</body>
</html>
